<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My GPT UI</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial; padding: 16px; max-width: 720px; margin: 0 auto; }
    input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; }
    textarea { height: 120px; }
    pre { white-space: pre-wrap; background:#f6f6f6; padding:12px; border-radius:10px; }
  </style>
</head>
<body>
  <h2>Cloud Run GPT (şifreli)</h2>

  <label>Servis URL (değiştirme):</label>
  <input id="baseUrl" value="https://chatgptapi-766809067486.europe-west1.run.app" />

  <label>Şifre (INTERNAL_API_KEY):</label>
  <input id="key" type="password" placeholder="x-api-key" />

  <label>Soru:</label>
  <textarea id="q" placeholder="Bir şey sor..."></textarea>

  <button id="btn">Gönder</button>

  <pre id="out"></pre>

<script>
  const keyInput = document.getElementById("key");
  const qInput = document.getElementById("q");
  const out = document.getElementById("out");

  // Sayfa açılınca kayıtlı şifreyi yükle
  window.onload = () => {
    const savedKey = localStorage.getItem("MY_API_KEY");
    if (savedKey) keyInput.value = savedKey;
  };

  async function ask() {
    const key = keyInput.value.trim();
    const q = qInput.value.trim();

    if (!key) { out.textContent = "Şifre gir"; return; }
    if (!q) { out.textContent = "Soru gir"; return; }

    // Şifreyi cihazda sakla
    localStorage.setItem("MY_API_KEY", key);

    out.textContent = "Gönderiliyor...";

    try {
      const res = await fetch(
        "https://chatgptapi-766809067486.europe-west1.run.app/ask?q=" + encodeURIComponent(q),
        { headers: { "x-api-key": key } }
      );

      const data = await res.json();
      out.textContent = data.answer || JSON.stringify(data, null, 2);
    } catch (e) {
      out.textContent = "Hata: " + e;
    }
  }
</script>

</body>
</html>