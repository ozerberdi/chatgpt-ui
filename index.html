<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My GPT UI</title>
</head>
<body style="font-family:sans-serif; padding:20px; max-width:700px; margin:auto;">
  <h2>Cloud Run GPT</h2>

  <label>Şifre (INTERNAL_API_KEY):</label>
  <input id="key" type="password" style="width:100%; padding:10px;" />

  <label>Soru:</label>
  <textarea id="q" style="width:100%; height:100px;"></textarea>

  <button onclick="ask()" style="padding:10px; width:100%;">Gönder</button>

  <pre id="out"></pre>


  <script>
  const keyInput = document.getElementById("key");
  const qInput = document.getElementById("q");
  const out = document.getElementById("out");

  // Sayfa açılınca kayıtlı şifreyi yükle
  window.onload = () => {
    const savedKey = localStorage.getItem("MY_API_KEY");
    if (savedKey) keyInput.value = savedKey;
  };

  async function ask() {
    const key = keyInput.value.trim();
    const q = qInput.value.trim();

    if (!key) { out.textContent = "Şifre gir"; return; }
    if (!q) { out.textContent = "Soru gir"; return; }

    // Şifreyi cihazda sakla
    localStorage.setItem("MY_API_KEY", key);

    out.textContent = "Gönderiliyor...";

    try {
      const res = await fetch(
        "https://chatgptapi-766809067486.europe-west1.run.app/ask?q=" + encodeURIComponent(q),
        { headers: { "x-api-key": key } }
      );

      const data = await res.json();
      out.textContent = data.answer || JSON.stringify(data, null, 2);
    } catch (e) {
      out.textContent = "Hata: " + e;
    }
  }
  </script>
  
</body>
</html>
